<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KDFC Admin Pro</title>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;600;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
        /* --- THEME --- */
        :root { --gold: #FFD700; --blue: #00F0FF; --red: #ff4444; --dark: #080808; --glass: rgba(30, 30, 40, 0.9); }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; background: var(--dark); color: white; font-family: 'Rajdhani', sans-serif;
            background-image: url('https://images.unsplash.com/photo-1516216628859-9bccecab13ca?q=80&w=2000');
            background-size: cover; background-position: center; background-attachment: fixed;
            height: 100vh; display: flex; overflow: hidden;
        }
        body::before { content:''; position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:-1; }

        /* --- LAYOUT --- */
        /* Desktop Sidebar */
        .sidebar {
            width: 260px; background: rgba(10, 10, 15, 0.95); border-right: 1px solid #333;
            padding: 20px; display: flex; flex-direction: column; z-index: 100;
        }
        
        /* Mobile Bottom Nav */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar {
                width: 100%; height: 65px; flex-direction: row; order: 2;
                padding: 0; justify-content: space-around; align-items: center;
                border-right: none; border-top: 1px solid #333; background: #000;
            }
            .brand { display: none; }
            .nav-btn { 
                flex-direction: column; gap: 0; padding: 5px; font-size: 0.75rem; 
                margin: 0; justify-content: center; background: transparent !important;
            }
            .nav-btn i { font-size: 1.2rem; margin-bottom: 2px; }
            .main { order: 1; height: calc(100vh - 65px); padding: 15px; padding-bottom: 80px; }
        }

        .main { flex: 1; padding: 30px; overflow-y: auto; }
        
        .brand { font-family: 'Teko'; font-size: 3rem; text-align: center; color: white; margin-bottom: 30px; text-shadow: 0 0 10px var(--blue); }
        .brand span { color: var(--gold); }
        
        .nav-btn {
            background: transparent; color: #888; border: none; padding: 15px; 
            text-align: left; font-size: 1.2rem; cursor: pointer; border-radius: 10px;
            display: flex; gap: 15px; align-items: center; transition: 0.3s; margin-bottom: 5px;
        }
        .nav-btn:hover, .nav-btn.active { background: rgba(0, 240, 255, 0.1); color: var(--blue); }

        /* --- CONTENT --- */
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { font-family: 'Teko'; font-size: 2.5rem; border-bottom: 1px solid #333; margin-top: 0; color: var(--gold); }

        .card {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; padding: 15px; margin-bottom: 15px; backdrop-filter: blur(5px);
        }

        /* Inputs */
        input {
            background: #000; border: 1px solid #444; color: white; padding: 10px;
            border-radius: 6px; font-family: 'Rajdhani'; font-size: 1rem; width: 100%;
            text-align: center; margin-bottom: 5px;
        }
        input:focus { border-color: var(--blue); }
        input.text-left { text-align: left; }

        .row { display: flex; gap: 5px; align-items: center; }

        /* Checkbox for "Finished" */
        .chk-wrap { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; color: #aaa; cursor: pointer; margin-bottom: 5px; }
        input[type="checkbox"] { width: 18px; height: 18px; accent-color: #00E676; margin: 0; }

        /* BUTTONS */
        .btn-action { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px; font-size: 1rem; }
        .btn-blue { background: var(--blue); color: black; }
        .btn-red { background: var(--red); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        
        .win-btn { background: #333; color: white; border: 1px solid #555; padding: 5px 10px; font-size: 0.8rem; cursor: pointer; margin-left: 5px; }
        .win-btn:hover { background: var(--gold); color: black; }

        /* FAB */
        .fab {
            position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px;
            background: #00E676; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; color: black; box-shadow: 0 0 20px rgba(0,230,118,0.4); cursor: pointer; z-index: 200; border: none;
        }
        @media (max-width: 768px) { .fab { bottom: 80px; right: 20px; } }

        /* LOGIN */
        #login { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        /* TOAST */
        #toast { position:fixed; top:-50px; left:50%; transform:translateX(-50%); background:#00E676; color:black; padding:10px 20px; border-radius:30px; font-weight:bold; transition:0.3s; z-index:300; }
    </style>
</head>
<body>

<!-- NOTIFICATION -->
<div id="toast">Saved Successfully!</div>

<!-- LOGIN -->
<div id="login">
    <h1 style="font-family:'Teko'; font-size:4rem; color:var(--blue); margin:0;">KDFC ADMIN</h1>
    <button onclick="signin()" style="background:white; padding:15px 40px; border-radius:50px; font-weight:bold; font-size:1.2rem; cursor:pointer; border:none;">Login with Google</button>
    <p id="err" style="color:red; margin-top:20px;"></p>
</div>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="brand">KDFC <span>PRO</span></div>
    <button class="nav-btn active" onclick="go('setup')"><i class="fa-solid fa-sliders"></i> Setup</button>
    <button class="nav-btn" onclick="go('qual')"><i class="fa-solid fa-filter"></i> Quals</button>
    <button class="nav-btn" onclick="go('groups')"><i class="fa-solid fa-users"></i> Groups</button>
    <button class="nav-btn" onclick="go('matches')"><i class="fa-solid fa-futbol"></i> Matches</button>
    <button class="nav-btn" onclick="go('knock')"><i class="fa-solid fa-trophy"></i> Bracket</button>
    <button class="nav-btn" onclick="logout()" style="color:var(--red); margin-top:auto;"><i class="fa-solid fa-power-off"></i> Exit</button>
</div>

<!-- MAIN CONTENT -->
<div class="main">
    
    <!-- 1. SETUP -->
    <div id="setup" class="page active">
        <h2>TOURNAMENT SETUP</h2>
        <div class="card">
            <label style="color:#aaa;">Number of Groups (2, 4, 8)</label>
            <input type="number" id="nG" value="4">
            <br><br>
            <label style="color:#aaa;">Players per Group</label>
            <input type="number" id="nP" value="4">
            <br><br>
            <button onclick="initDB()" class="btn-action btn-red">RESET DATABASE</button>
        </div>
    </div>

    <!-- 2. QUALIFIERS -->
    <div id="qual" class="page">
        <h2>PRE-QUALIFIERS</h2>
        <button onclick="addQual()" class="btn-action btn-gold">+ ADD MATCH</button>
        <div id="q-ui"></div>
    </div>

    <!-- 3. GROUPS -->
    <div id="groups" class="page">
        <h2>EDIT PLAYERS</h2>
        <div id="g-ui" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:15px;"></div>
    </div>

    <!-- 4. MATCHES -->
    <div id="matches" class="page">
        <h2>GROUP MATCHES</h2>
        <button onclick="genFix()" class="btn-action btn-blue">1. GENERATE FIXTURES</button>
        <button onclick="calcStats()" class="btn-action btn-gold">2. UPDATE RANKINGS (AUTO)</button>
        <div id="m-ui"></div>
    </div>

    <!-- 5. KNOCKOUT -->
    <div id="knock" class="page">
        <h2>KNOCKOUT BRACKET</h2>
        <button onclick="genKnock()" class="btn-action btn-blue">AUTO-GENERATE (Top 2)</button>
        <div id="k-ui" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:15px;"></div>
    </div>

</div>

<button class="fab" onclick="save()"><i class="fa-solid fa-floppy-disk"></i></button>

<script>
    // --- 1. CONFIGURATION ---
    const ALLOWED = ["kuzurxyz@gmail.com"]; // REPLACE WITH YOUR EMAIL
    
    const firebaseConfig = {
  apiKey: "AIzaSyBIrBWQ4g_Bslww6XwmsZWv9OlHEsjRweE",
  authDomain: "wr-chat-d59f0.firebaseapp.com",
  databaseURL: "https://wr-chat-d59f0-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "wr-chat-d59f0",
  storageBucket: "wr-chat-d59f0.appspot.com",
  messagingSenderId: "256624682348",
  appId: "1:256624682348:web:24d5c6406ae87266bbff49",
  measurementId: "G-LDTY5VQJ45"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let data = { groups: {}, matches: [], bracket: [], qualifiers: [] };

    // --- AUTH ---
    auth.onAuthStateChanged(u => {
        if(u && ALLOWED.includes(u.email)) {
            document.getElementById('login').style.display = 'none';
            db.ref().on('value', snap => {
                if(snap.val()) { 
                    data = snap.val(); 
                    if(!data.qualifiers) data.qualifiers=[];
                    renderAll();
                }
            });
        } else if (u) {
            document.getElementById('err').innerText = "Access Denied: " + u.email;
            auth.signOut();
        }
    });

    function signin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function logout() { auth.signOut(); location.reload(); }

    function renderAll() {
        renderQ(); renderG(); renderM(); renderK();
    }

    // --- 1. SETUP ---
    function initDB() {
        if(!confirm("DELETE ALL DATA?")) return;
        let nG=document.getElementById('nG').value, nP=document.getElementById('nP').value;
        let g={}, c="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        for(let i=0; i<nG; i++) {
            g[c[i]] = Array(parseInt(nP)).fill().map((_,j)=>({
                name:`P${j+1}`, photo:'', 
                p:0, w:0, d:0, l:0, 
                gf:0, ga:0, gd:0, pts:0
            }));
        }
        db.ref().set({groups:g, matches:[], bracket:[], qualifiers:[]});
        showToast("Reset Complete");
    }

    // --- 2. QUALIFIERS ---
    function addQual() { data.qualifiers.push({p1:'A', s1:0, p2:'B', s2:0, date:''}); save(); }
    function renderQ() {
        const ui = document.getElementById('q-ui'); ui.innerHTML='';
        data.qualifiers.forEach((m,i) => {
            ui.innerHTML += `<div class="card" style="border-left:3px solid var(--red)">
                <input value="${m.date||''}" onchange="upQ(${i},'date',this.value)" placeholder="Date/Time">
                <div class="row">
                    <input value="${m.p1}" onchange="upQ(${i},'p1',this.value)" class="text-left" style="flex:1"> 
                    <input type="number" value="${m.s1}" onchange="upQ(${i},'s1',this.value)" style="width:50px">
                    <input type="number" value="${m.s2}" onchange="upQ(${i},'s2',this.value)" style="width:50px">
                    <input value="${m.p2}" onchange="upQ(${i},'p2',this.value)" class="text-left" style="flex:1">
                </div>
                <button onclick="delQ(${i})" class="btn-action btn-red" style="padding:5px; margin:0; font-size:0.8rem;">DELETE</button>
            </div>`;
        });
    }
    function upQ(i,f,v) { data.qualifiers[i][f] = f.includes('s')?parseInt(v):v; }
    function delQ(i) { data.qualifiers.splice(i,1); save(); }

    // --- 3. GROUPS ---
    function renderG() {
        const ui = document.getElementById('g-ui'); ui.innerHTML='';
        Object.keys(data.groups).forEach(g => {
            let h = `<div class="card"><h3 style="color:var(--blue)">GROUP ${g}</h3>`;
            data.groups[g].forEach((p,i) => {
                h += `<div class="row" style="flex-wrap:wrap;">
                    <input value="${p.name}" onchange="upG('${g}',${i},'name',this.value)" class="text-left" style="flex:2; min-width:120px;" placeholder="Name">
                    <input value="${p.photo}" onchange="upG('${g}',${i},'photo',this.value)" class="text-left" style="flex:1; min-width:80px;" placeholder="Img URL">
                    <div style="display:flex; gap:5px; flex:1;">
                        <input value="${p.p}" readonly style="background:#222; color:#888;" title="Played">
                        <input value="${p.w}" readonly style="background:#222; color:#00E676;" title="Won">
                        <input value="${p.pts}" readonly style="background:#222; color:var(--blue);" title="Points">
                    </div>
                </div>`;
            });
            ui.innerHTML += h+'</div>';
        });
    }
    function upG(g,i,f,v) { data.groups[g][i][f]=v; }

    // --- 4. MATCHES ---
    function genFix() {
        if(!confirm("Create Matches?")) return;
        let m=[]; Object.keys(data.groups).forEach(g=>{ let p=data.groups[g]; for(let i=0;i<p.length;i++) for(let j=i+1;j<p.length;j++) m.push({p1:p[i].name,p2:p[j].name,s1:0,s2:0,group:g,date:'',played:false}); });
        data.matches=m; save();
    }

    function calcStats() {
        // Reset ALL stats
        Object.keys(data.groups).forEach(g => {
            data.groups[g].forEach(p => { p.p=0; p.w=0; p.d=0; p.l=0; p.gf=0; p.ga=0; p.gd=0; p.pts=0; });
        });

        data.matches.forEach(m => {
            if(!m.played) return; // Ignore unplayed matches

            let grp = data.groups[m.group];
            if(!grp) return;
            let p1 = grp.find(p=>p.name===m.p1), p2 = grp.find(p=>p.name===m.p2);

            if(p1 && p2) {
                p1.p++; p2.p++;
                p1.gf += m.s1; p1.ga += m.s2; p1.gd = p1.gf - p1.ga;
                p2.gf += m.s2; p2.ga += m.s1; p2.gd = p2.gf - p2.ga;

                if(m.s1 > m.s2) { p1.w++; p1.pts+=3; p2.l++; }
                else if(m.s2 > m.s1) { p2.w++; p2.pts+=3; p1.l++; }
                else { p1.d++; p1.pts+=1; p2.d++; p2.pts+=1; }
            }
        });
        save();
        showToast("Stats Updated!");
    }

    function renderM() {
        const ui = document.getElementById('m-ui'); ui.innerHTML='';
        data.matches.forEach((m,i) => {
            let border = m.played ? '4px solid #00E676' : '4px solid #333';
            ui.innerHTML += `<div class="card" style="border-left:${border}; padding:10px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="color:var(--gold); font-size:0.8rem;">[${m.group}] ${m.p1} vs ${m.p2}</span>
                    <label class="chk-wrap"><input type="checkbox" ${m.played?'checked':''} onchange="upM(${i},'played',this.checked)"> FINISHED</label>
                </div>
                <input value="${m.date||''}" onchange="upM(${i},'date',this.value)" placeholder="Date/Time" style="width:100%; margin-bottom:5px;">
                <div style="display:flex; gap:10px; justify-content:center;">
                    <input type="number" value="${m.s1}" onchange="upM(${i},'s1',this.value)" style="width:60px;">
                    <span style="color:white; font-weight:bold; align-self:center;">-</span>
                    <input type="number" value="${m.s2}" onchange="upM(${i},'s2',this.value)" style="width:60px;">
                </div>
            </div>`;
        });
    }
    function upM(i,f,v) { data.matches[i][f] = (f==='s1'||f==='s2')?parseInt(v):v; }

    // --- 5. KNOCKOUT ---
    function genKnock() {
        if(!confirm("Gen Top 2?")) return;
        const k=Object.keys(data.groups);
        let s = k.length===2?3:(k.length===4?7:15);
        data.bracket = Array(s).fill().map(()=>({p1:'TBD', p1_img:'', s1:0, p2:'TBD', p2_img:'', s2:0, date:''}));
        
        let idx=0;
        for(let i=0;i<k.length;i+=2) {
            let g1=data.groups[k[i]].sort((a,b)=>b.pts-a.pts || b.gd-a.gd); 
            let g2=data.groups[k[i+1]].sort((a,b)=>b.pts-a.pts || b.gd-a.gd);
            data.bracket[idx].p1=g1[0].name; data.bracket[idx].p1_img=g1[0].photo;
            data.bracket[idx].p2=g2[1].name; data.bracket[idx].p2_img=g2[1].photo; idx++;
            data.bracket[idx].p1=g2[0].name; data.bracket[idx].p1_img=g2[0].photo;
            data.bracket[idx].p2=g1[1].name; data.bracket[idx].p2_img=g1[1].photo; idx++;
        }
        save();
    }

    function renderK() {
        const ui = document.getElementById('k-ui'); ui.innerHTML='';
        data.bracket.forEach((m,i) => {
            ui.innerHTML += `<div class="card" style="border:1px solid var(--gold)">
                <div style="color:var(--gold); font-size:0.8rem;">MATCH ${i+1}</div>
                <div class="row">
                    <span style="flex:1; font-size:0.9rem;">${m.p1}</span>
                    <input type="number" value="${m.s1}" onchange="upK(${i},'s1',this.value)" style="width:40px">
                    <button class="win-btn" onclick="win(${i},'p1')">W</button>
                </div>
                <div class="row">
                    <span style="flex:1; font-size:0.9rem;">${m.p2}</span>
                    <input type="number" value="${m.s2}" onchange="upK(${i},'s2',this.value)" style="width:40px">
                    <button class="win-btn" onclick="win(${i},'p2')">W</button>
                </div>
                <input value="${m.date||''}" onchange="upK(${i},'date',this.value)" placeholder="Date" style="width:100%; margin-top:5px;">
            </div>`;
        });
    }
    function upK(i,f,v) { data.bracket[i][f] = (f==='s1'||f==='s2')?parseInt(v):v; }
    function win(i, key) {
        let next = i<8 ? 8+Math.floor(i/2) : (i<12 ? 12+Math.floor((i-8)/2) : 14);
        let slot = (i%2===0)?'1':'2';
        data.bracket[next]['p'+slot] = data.bracket[i][key];
        data.bracket[next]['p'+slot+'_img'] = data.bracket[i][key+'_img'];
        save();
    }

    function save() { db.ref().set(data); showToast("Saved!"); }
    function showToast(m) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.top = "20px";
        setTimeout(() => { t.style.top = "-50px"; }, 2000);
    }
    function go(id) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>